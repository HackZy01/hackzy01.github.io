<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pattern wallpapers</title>
    <style>
        /* --- One UI 7 Dark Theme --- */
        :root {
            --oneui-bg-color: #191919;
            --oneui-card-bg: #242424;
            --oneui-card-bg-hover: #2f2f2f;
            --oneui-text-color: #ededed;
            --oneui-secondary-text-color: #a8a8a8;
            --oneui-border-color: #3a3a3a;
            --oneui-accent-color: #0d6efd;
            --oneui-accent-hover-color: #3d8bfd;
            --oneui-radio-bg: #333333;
            --oneui-radio-hover-bg: #404040;
            --oneui-shadow-color: rgba(0, 0, 0, 0.5);
            --oneui-border-radius: 18px;
            --oneui-border-radius-small: 10px;
            --oneui-padding: 22px;
            --oneui-padding-small: 12px;
            --oneui-gap: 18px;
            --oneui-shadow: 0 8px 20px var(--oneui-shadow-color);
            --oneui-mobile-title-height: 80px;
        }

        html { scroll-behavior: smooth; }
        *, *::before, *::after { box-sizing: border-box; }

        body {
            font-family: "Samsung Sans", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--oneui-bg-color);
            margin: 0;
            padding: 0 var(--oneui-padding) var(--oneui-padding) var(--oneui-padding);
            color: var(--oneui-text-color);
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh; font-size: 16px;
             -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
        }

        .main-container {
            width: 100%; max-width: 550px; display: flex; flex-direction: column;
            gap: 25px; /* Keep original gap */
            transition: max-width 0.3s ease;
            margin-top: 60%;
        }

        h1 { /* Mobile Title */
            text-align: center; width: 100%; max-width: 550px; position: absolute;
            top: 10%; left: 50%; transform: translateX(-50%);
            padding: 0 var(--oneui-padding); margin: 0; font-weight: 600;
            font-size: 2.2em; color: var(--oneui-text-color); letter-spacing: -0.5px;
            z-index: 5;
        }

        .card {
            background-color: var(--oneui-card-bg); border-radius: var(--oneui-border-radius);
            padding: var(--oneui-padding); /* Restore original padding */
            box-shadow: none; border: 1px solid var(--oneui-border-color);
            overflow: hidden; transition: background-color 0.2s ease, border-color 0.2s ease;
        }
        .card h2 {
            margin: 0 0 var(--oneui-gap) 0; font-size: 1.3em; font-weight: 600; /* Restore original H2 */
            color: var(--oneui-text-color); border-bottom: 1px solid var(--oneui-border-color);
            padding-bottom: var(--oneui-padding-small); letter-spacing: -0.2px;
        }

        .left-column { display: flex; flex-direction: column; gap: 25px; } /* Mobile gap */

        /* --- Image Selection Styling --- */
        .image-selector { display: flex; flex-direction: column; gap: var(--oneui-gap); margin: 0; }
        .image-selector-item {
            display: flex; align-items: center; gap: 15px; padding: var(--oneui-padding-small);
            border: 1px solid transparent; border-radius: var(--oneui-border-radius-small);
            cursor: pointer; transition: background-color 0.2s ease, border-color 0.2s ease;
            background-color: var(--oneui-radio-bg);
        }
        .image-selector-item:hover { background-color: var(--oneui-radio-hover-bg); border-color: var(--oneui-border-color); }
        .image-selector input[type="radio"] {
            appearance: none; -webkit-appearance: none; margin: 0; width: 20px; height: 20px;
            border: 2px solid var(--oneui-secondary-text-color); border-radius: 50%;
            cursor: pointer; position: relative; flex-shrink: 0; transition: border-color 0.2s ease;
        }
        .image-selector input[type="radio"]:checked { border-color: var(--oneui-accent-color); }
        .image-selector input[type="radio"]:checked::after {
             content: ''; display: block; width: 10px; height: 10px;
             background-color: var(--oneui-accent-color); border-radius: 50%;
             position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        }
        /* Selected item style */
        .image-selector-item.item-checked {
             background-color: color-mix(in srgb, var(--oneui-card-bg) 75%, var(--oneui-accent-color) 25%);
             border-color: var(--oneui-accent-color);
        }
        .image-selector-item.item-checked .pattern-label { color: var(--oneui-text-color); font-weight: 500; }
        .image-selector-item.item-checked input[type="radio"] { border-color: var(--oneui-accent-color); }
        .pattern-preview {
            width: 45px; height: 45px; object-fit: cover; border-radius: var(--oneui-border-radius-small);
            border: 1px solid var(--oneui-border-color); flex-shrink: 0; background-color: var(--oneui-bg-color);
        }
        .pattern-label {
            font-size: 1em; color: var(--oneui-secondary-text-color); flex-grow: 1; margin: 0;
             transition: color 0.2s ease, font-weight 0.2s ease; font-weight: 400;
        }

        /* --- Color Controls Styling --- */
        .color-controls {
            display: flex; justify-content: space-around; align-items: center;
            gap: 25px; flex-wrap: wrap; margin-top: var(--oneui-padding-small);
        }
        .color-picker-group { display: flex; flex-direction: column; align-items: center; gap: 10px; }
        .color-picker-group label { font-size: 0.95em; font-weight: 500; color: var(--oneui-secondary-text-color); }
        .color-picker-group input[type="color"] {
            -webkit-appearance: none; appearance: none; width: 60px; height: 60px;
            border: 1px solid var(--oneui-border-color); border-radius: 50%; cursor: pointer;
            overflow: hidden; padding: 0; background-color: transparent;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); transition: transform 0.1s ease;
        }
        .color-picker-group input[type="color"]:active { transform: scale(0.95); }
        .color-picker-group input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
        .color-picker-group input[type="color"]::-webkit-color-swatch { border: none; border-radius: 50%; }
        .color-picker-group input[type="color"]::-moz-color-swatch { border: none; border-radius: 50%; }


        .download-btn {
            display: block; width: 100%;
            padding: 12px;
            margin-top: 4px;
            font-size: 1em;
            font-weight: 500;
            color: var(--oneui-text-color);
            background-color: var(--oneui-accent-color);
            border: 1px solid var(--oneui-accent-color);
            border-radius: 25px;
            cursor: pointer;
            text-align: center;
            transition: background-color 0.2s ease, border-color 0.2s ease, transform 0.1s ease;
        }
        .download-btn:hover {
            background-color: var(--oneui-accent-hover-color);
            border-color: var(--oneui-accent-hover-color);
			border-radius: 20px
        }
        .download-btn:active {
            background-color: var(--oneui-accent-color);
            border-color: var(--oneui-accent-color);
            color: #ffffff;
            transform: scale(0.97);
        }


        /* --- Output Area Styling --- */
        .right-column .card { min-height: 250px; display: flex; flex-direction: column; }
        .output-container {
            position: relative; flex-grow: 1; display: flex; justify-content: center; align-items: center;
            background-color: var(--oneui-bg-color);
            border-radius: var(--oneui-border-radius-small);
            margin-top: var(--oneui-gap); min-height: 200px; padding: var(--oneui-padding-small);
            overflow: hidden;
        }
        #output-image { display: none; }
        #output-canvas {
            display: block; max-width: 100%; max-height: 400px; /* Mobile */
            height: auto; width: auto; object-fit: contain;
            border-radius: var(--oneui-border-radius-small); transition: opacity 0.3s ease;
        }
        .loading-overlay {
             position: absolute; top: 0; left: 0; width: 100%; height: 100%;
             background-color: rgba(36, 36, 36, 0.7); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px);
             display: flex; flex-direction: column; justify-content: center; align-items: center;
             font-size: 1.1em; color: var(--oneui-text-color); z-index: 10;
             border-radius: var(--oneui-border-radius-small); transition: opacity 0.3s ease, visibility 0s 0.3s;
             opacity: 0; visibility: hidden; pointer-events: none;
        }
        .loading-overlay.visible { opacity: 1; visibility: visible; pointer-events: auto; transition: opacity 0.3s ease, visibility 0s 0s; }
        .loading-overlay span { margin-top: 10px; font-weight: 500; }


        @media (min-width: 768px) {
             body { padding: var(--oneui-padding); }
             h1 { display: none; } /* Hide mobile title */
            .main-container {
                flex-direction: row; max-width: 1200px; align-items: flex-start;
                gap: 35px;
                margin-top: 0;
            }
            .left-column {
                flex: 1; display: flex; flex-direction: column;
                gap: 30px;
                min-width: 275px;
            }
            .right-column {
                flex: 2; position: sticky; top: var(--oneui-padding);
            }
             .right-column .card {
                 height: 100%; box-shadow: var(--oneui-shadow);
                 padding: var(--oneui-padding); display: flex; flex-direction: column;
                 overflow: hidden;
             }
             .right-column .card h2 { font-size: 1.4em; flex-shrink: 0; }

             .right-column .output-container {
                 flex-grow: 1; margin-top: var(--oneui-gap); min-height: 0;
                 padding: 15; background-color: var(--oneui-radio-bg); 
                 border-radius: var(--oneui-border-radius-small);
                 border: 1px solid var(--oneui-border-color);
                 display: flex; justify-content: center; align-items: center;
                 overflow: hidden;
             }
             #output-canvas {
                  max-width: 75%; max-height: 75%; width: auto; height: auto;
                  object-fit: contain; border-radius: var(--oneui-border-radius-small);
             }

             /* Adjust button margin for desktop */
             .download-btn { margin-top: var(--oneui-gap); }

        @media (max-width: 480px) {
              :root { --oneui-padding: 18px; --oneui-mobile-title-height: 70px; }
              h1 { font-size: 1.8em; }
              .main-container { gap: 20px; }
              .card { padding: 18px; /* Consistent padding */ border-radius: 16px; }
              .card h2 { font-size: 1.2em; margin-bottom: 18px;}
              .pattern-label { font-size: 0.95em;}
              .pattern-preview { width: 40px; height: 40px;}
              .image-selector-item { gap: 12px; padding: 10px;}
              .color-picker-group input[type="color"] { width: 50px; height: 50px; }
              .color-controls { gap: 20px; }
              #output-canvas { max-height: 300px; }
              .download-btn { padding: 12px 15px; font-size: 0.95em; }
        }
    </style>
	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
</head>
<body>

    <h1>Patterns</h1> <!-- Hidden for desktop-esque layouts -->

    <div class="main-container">

        <div class="left-column">
            <div class="card">
                <h2>Select Pattern</h2>
                <div class="image-selector">
                    <div class="image-selector-item item-checked" onclick="selectPattern(this, 'radio_1')" data-filename="pattern_500_001.webp" data-img-id="img_pattern_1">
                        <input type="radio" name="base_image" id="radio_1" value="pattern_500_001.webp" checked>
                        <img class="pattern-preview" src="images/pattern_500_001.webp" alt="Pattern 1 Preview" loading="lazy">
                        <label class="pattern-label" for="radio_1">Pattern 001</label>
                    </div>
                    <div class="image-selector-item" onclick="selectPattern(this, 'radio_2')" data-filename="pattern_500_002.webp" data-img-id="img_pattern_2">
                        <input type="radio" name="base_image" id="radio_2" value="pattern_500_002.webp">
                        <img class="pattern-preview" src="images/pattern_500_002.webp" alt="Pattern 2 Preview" loading="lazy">
                        <label class="pattern-label" for="radio_2">Pattern 002</label>
                    </div>
                    <div class="image-selector-item" onclick="selectPattern(this, 'radio_3')" data-filename="pattern_500_003.webp" data-img-id="img_pattern_3">
                        <input type="radio" name="base_image" id="radio_3" value="pattern_500_003.webp">
                        <img class="pattern-preview" src="images/pattern_500_003.webp" alt="Pattern 3 Preview" loading="lazy">
                        <label class="pattern-label" for="radio_3">Pattern 003</label>
                    </div>
                </div>
                 <div style="display:none;">
                     <img id="img_pattern_1" src="images/pattern_500_001.webp">
                     <img id="img_pattern_2" src="images/pattern_500_002.webp">
                     <img id="img_pattern_3" src="images/pattern_500_003.webp">
                 </div>
            </div>

            <!-- Controls Card -->
            <div class="card">
                <h2>Adjust Colors</h2>
                <div class="color-controls">
                    <div class="color-picker-group">
                        <label for="color-start">Primary</label>
                        <input type="color" id="color-start" value="#AC6AFF">
                    </div>
                    <div class="color-picker-group">
                        <label for="color-end">Secondary</label>
                        <input type="color" id="color-end" value="#F8F0FF">
                    </div>
                </div>
            </div>

            <!-- Download Button -->
            <button id="download-button" class="download-btn">Download</button>

        </div> <!-- End left-column -->

        <div class="right-column">
            <!-- Output Card -->
            <div class="card">
                <h2>Preview</h2>
                <div class="output-container">
                    <div id="loading" class="loading-overlay">
                        <span>We're working on it!</span>
                    </div>
                    <canvas id="output-canvas" width="500" height="500"></canvas>
                    <img id="output-image" src="" alt="Generated pattern"> <!-- Hidden -->
                </div>
            </div>
        </div>

    </div>

    <!-- JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const colorStartPicker = document.getElementById('color-start');
            const colorEndPicker = document.getElementById('color-end');
            const outputCanvas = document.getElementById('output-canvas');
            const outputCtx = outputCanvas.getContext('2d', { willReadFrequently: true });
            const loadingIndicator = document.getElementById('loading');
            const downloadButton = document.getElementById('download-button'); // Get button
            const imageSelectors = document.querySelectorAll('.image-selector-item');

            const sourceCanvas = document.createElement('canvas');
            const sourceCtx = sourceCanvas.getContext('2d');

            let debounceTimer;
            let currentFilename = document.querySelector('.image-selector-item.item-checked')?.dataset.filename;
            let currentImageElement = null;
            let isProcessing = false;

            function hexToRgb(hex) { 
                const bigint = parseInt(hex.slice(1), 16);
                const r = (bigint >> 16) & 255; const g = (bigint >> 8) & 255; const b = bigint & 255;
                return { r, g, b };
            }
            function showLoading(isLoading) { 
                loadingIndicator?.classList.toggle('visible', isLoading);
                if (outputCanvas) { outputCanvas.style.opacity = isLoading ? '0.3' : '1'; }
            }
            function applyRecoloring(sourceImgElement, startColorHex, endColorHex) { 
                 if (!sourceImgElement || !sourceImgElement.complete || sourceImgElement.naturalWidth === 0) { console.error("Source image not ready:", sourceImgElement?.id); showLoading(false); isProcessing = false; return; }
                 if (isProcessing) { console.warn("Already processing."); return; }
                 isProcessing = true; showLoading(true);
                 return new Promise((resolve) => {
                     requestAnimationFrame(() => {
                         setTimeout(() => {
                            try {
                                 const startColor = hexToRgb(startColorHex); const endColor = hexToRgb(endColorHex);
                                 const width = sourceImgElement.naturalWidth; const height = sourceImgElement.naturalHeight;
                                 if (sourceCanvas.width !== width) sourceCanvas.width = width; if (sourceCanvas.height !== height) sourceCanvas.height = height;
                                 if (outputCanvas.width !== width) outputCanvas.width = width; if (outputCanvas.height !== height) outputCanvas.height = height;
                                 sourceCtx.clearRect(0, 0, width, height); sourceCtx.drawImage(sourceImgElement, 0, 0, width, height);
                                 const imageData = sourceCtx.getImageData(0, 0, width, height); const data = imageData.data;
                                 const outputImageData = outputCtx.createImageData(width, height); const outputData = outputImageData.data;
                                 for (let i = 0; i < data.length; i += 4) {
                                     const grayscaleValue = data[i]; const alpha = data[i + 3]; const t = grayscaleValue / 255.0;
                                     outputData[i] = Math.round(startColor.r * (1 - t) + endColor.r * t); outputData[i + 1] = Math.round(startColor.g * (1 - t) + endColor.g * t); outputData[i + 2] = Math.round(startColor.b * (1 - t) + endColor.b * t); outputData[i + 3] = alpha;
                                 }
                                 outputCtx.putImageData(outputImageData, 0, 0); console.log("Processing complete:", sourceImgElement.id);
                                 isProcessing = false; showLoading(false); resolve();
                             } catch (error) {
                                  console.error("Processing error:", error, sourceImgElement?.id);
                                  if (error.name === 'SecurityError') { alert("Canvas Security Error..."); } else { alert("Processing error..."); }
                                  isProcessing = false; showLoading(false); resolve();
                             }
                         }, 10); }); });
            }
            function triggerUpdate() { /* ... as before ... */
                 if (!currentFilename) { console.warn("triggerUpdate no filename"); return; }
                 const imgId = document.querySelector(`.image-selector-item[data-filename="${currentFilename}"]`)?.dataset.imgId;
                 currentImageElement = imgId ? document.getElementById(imgId) : null;
                 if (currentImageElement) {
                     const handleLoad = () => { currentImageElement.removeEventListener('load', handleLoad); currentImageElement.removeEventListener('error', handleError); console.log("Selected loaded:", currentFilename); applyRecoloring(currentImageElement, colorStartPicker.value, colorEndPicker.value); };
                     const handleError = () => { currentImageElement.removeEventListener('load', handleLoad); currentImageElement.removeEventListener('error', handleError); console.error("Failed load selected:", currentFilename); alert(`Failed load pattern: ${currentFilename}`); showLoading(false); isProcessing = false; };
                     currentImageElement.addEventListener('load', handleLoad); currentImageElement.addEventListener('error', handleError);
                     if (currentImageElement.complete && currentImageElement.naturalWidth > 0) { console.log("Selected already complete:", currentFilename); setTimeout(handleLoad, 0); }
                     else if (currentImageElement.complete && currentImageElement.naturalWidth === 0) { console.error("Selected complete invalid:", currentFilename); setTimeout(handleError, 0); }
                     else { console.log("Waiting selected:", currentFilename); showLoading(true); }
                 } else { console.error("No image element:", currentFilename); showLoading(false); isProcessing = false; }
            }
            function handleColorChange() { clearTimeout(debounceTimer); debounceTimer = setTimeout(triggerUpdate, 250); }
            function handleDownload() { /* ... as before ... */
                 if (!outputCanvas) return;
                  try {
                     const baseFilename = currentFilename ? currentFilename.split('.')[0] : 'recolored-image';
                     const filename = `${baseFilename}_${colorStartPicker.value.slice(1)}-${colorEndPicker.value.slice(1)}.png`;
                     const dataURL = outputCanvas.toDataURL('image/png'); const link = document.createElement('a');
                     link.href = dataURL; link.download = filename; document.body.appendChild(link);
                     link.click(); document.body.removeChild(link); console.log("Downloaded:", filename);
                  } catch (e) { console.error("Download failed:", e); alert("Download failed."); }
            }

            // --- Event Listeners ---
            colorStartPicker.addEventListener('input', handleColorChange);
            colorEndPicker.addEventListener('input', handleColorChange);
            downloadButton.addEventListener('click', handleDownload);
            document.querySelectorAll('input[name="base_image"]').forEach(radio => {
                 radio.addEventListener('change', (event) => { if (event.target.checked) { currentFilename = event.target.value; triggerUpdate(); } });
            });

            // --- Initial Load Logic ---
             const initialImgId = document.querySelector('.image-selector-item.item-checked')?.dataset.imgId;
             const initialImageElement = initialImgId ? document.getElementById(initialImgId) : null;
             if (initialImageElement) { /* ... same load/error handling ... */
                 const handleInitialLoad = () => { initialImageElement.removeEventListener('load', handleInitialLoad); initialImageElement.removeEventListener('error', handleInitialError); console.log("Initial loaded:", initialImageElement.src); triggerUpdate(); };
                 const handleInitialError = (e) => { initialImageElement.removeEventListener('load', handleInitialLoad); initialImageElement.removeEventListener('error', handleInitialError); console.error("Initial error:", initialImageElement.src, e); alert("Failed initial load."); showLoading(false); isProcessing = false; };
                 initialImageElement.addEventListener('load', handleInitialLoad); initialImageElement.addEventListener('error', handleInitialError);
                 if (initialImageElement.complete && initialImageElement.naturalWidth > 0) { console.log("Initial already complete."); setTimeout(handleInitialLoad, 0); }
                 else if (initialImageElement.complete && initialImageElement.naturalWidth === 0) { console.error("Initial complete invalid."); setTimeout(handleInitialError, 0); }
                 else { console.log("Waiting initial..."); showLoading(true); }
             } else if (currentFilename) { console.warn("Initial filename but no element."); setTimeout(triggerUpdate, 50); }
             else { console.warn("No initial selection."); showLoading(false); }
        }); // DOMContentLoaded end

        // Helper function for clickable items
        function selectPattern(element, radioId) { 
            const radio = element.querySelector('input[type="radio"]');
            if (radio && !radio.checked) {
                 document.querySelectorAll('.image-selector-item').forEach(item => item.classList.remove('item-checked'));
                 element.classList.add('item-checked'); radio.checked = true;
                 radio.dispatchEvent(new Event('change', { bubbles: true }));
            } else if (radio && radio.checked) { console.log("Pattern already selected"); }
        }
    </script>
</body>
</html>